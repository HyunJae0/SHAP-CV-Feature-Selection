## 개인 프로젝트
통합공공임대주택 정책 대상 가구(청년, 신혼, 중장년, 고령 가구)별로 선택하여 공공임대주택 입주의향을 예측하는 데 큰 영향을 미치는 입주의향 결정 요인을 찾고자 하였습니다.

shap value를 cross validation하여 shap importance를 구한 뒤, shap importance를 기준으로 feature selection을 진행했습니다.

## Stack
```
Python
SHAP(SHapley Additive exPlanations)
```

# 코드 실행
## 1. Data preprocessing
아래 Jupyter Notebook으로 기술되어 있음. 
https://github.com/HyunJae0/SHAP-CV-Feature-Selection/blob/main/preprocessing.ipynb

사용한 데이터는 MDIS에서 제공한 2018, 2019, 2020, 2021년 주거실태조사 결과입니다. 

예측 대상이 '통합공공임대주택 정책 대상자'이기 때문에 서민층 및 중산층 무주택 가구를 기준으로, 각 대상 유형(청년, 신혼, 중장년, 고령)의 기준에 맞는 데이터만 추출했습니다. 이때, 이미 공공임대주택에 거주하고 있는 가구는 제외하였습니다. 단 한 번도 공공임대주택에 거주하지 않은 가구만 예측하기 위함입니다.

그리고 몇 가지 파생 변수를 만들었습니다. 예를 들어, 소득 대비 주택 임대로 비율은 정책 대상자들은 모두 무주택 가구이기 때문에, 무주택 가구의 소득 대비 주택 임대료에 대한 부담 정도에 따라 입주의향 여부가 나뉘는지 확인하기 위함입니다. 

이외에도 가구의 재무 건전성을 확인하기 위해 총 소득 대비 생활비의 비중, 총 소득 대비 월평균 주거관리비의 비중, 중/장기부채부담지표, 총 자산 대비 금융/기타 자산의 비중 등 다양한 파생 변수를 추가하였습니다.

## 2. SHAP


# 결과
예를 들어 신혼 가구의 공공임대주택 입주의향 모델 중 XGBoost 모델은 변수 개수별 모델별로 부트스트랩을 2000번 수행해서 비교한 결과, 17개의 변수를 사용했을 때 가장 성능이 높았습니다.

![image](https://github.com/user-attachments/assets/badbcfb5-f4da-4244-bb7e-d07d96d65966)

이 17개의 변수들이 신혼 가구의 공공임대주택 입주의향 모델에 어떠한 영향을 미쳤는지 shap value를 plot해서 확인할 수 있습니다.

![image](https://github.com/user-attachments/assets/8eed24a6-d20b-44f0-9a34-b961caeaa386)

위의 결과는 shap importance 순으로 나타낸 변수들입니다. 신혼 가구 공공임대주택 입주의향 모델에 가장 큰 영향력을 미친 변수는 '현재 가장 필요한 주거지원 1순위'. '현재 주택의 면적', '현재 주택의 점유형태', '주택 마련 예상 소요연수' .... 순입니다.

앞에 Cat_이 붙은 것은 원핫 인코딩된 범주형 변수들의 shap value를 하나로 합친 것을 의미합니다. (즉, 범주형 변수임을 의미합니다.)

Cat_이 붙지 않은 수치형 변수들에 대해 먼저 해석하자면, 신혼 가구에게는 '현재 주택의 면적'이 작을수록 '입주의향 있음(1)'에 좋은 영향을 미쳤습니다. 그리고 '장기부채부담지표'와 '중기부채부담지표'가 높을수록 '입주의향 있음(1)'에 영향을 미쳤음을 확인할 수 있고, '소득 대비 주택 임대료'의 비율은 낮을수록 '입주의향 있음(1)'에 영향을 미쳤습니다. '소득 대비 주거관리비의 비율'이 높을수록 '입주의향 있음(1)'에 영향을 미쳤습니다.

즉, 신혼 가구 데이터 중에서 현재 주택 면적이 좁고, 장기부채부담과 중기부채부담이 높으며, 현재 거주 중인 주택 임대료의 비율이 소득에서 차지하는 비율이 낮을수록, 소득 대비 주거관리비의 비율이 높을수록 '입주의향 없음(0)'과 '입주의향 있음(1)' 중 '입주의향 있음(1)'의 예측을 증가시키는 영향을 미친 것입니다.

다음 그림은 이 17개 변수에 대한 shap feature importance 입니다.

![image](https://github.com/user-attachments/assets/919dd092-b4d9-4695-b903-c83aa9f9c05f)

범주형 변수에 대한 영향 확인은 다음과 같습니다.

원-핫 인코딩된 범주형 변수를 다시 합친 이유는 해당 범주형 질문이 가지는 전체 영향력을 파악하기 위함입니다. 이 합친 범주형 변수를 다시 세분화해서 확인하려면,

예를 들어 '현재 가장 필요한 주거지원 1순위'라는 범주형 변수의 고유 카테고리 개수를 확인한 다음, '주거지원 1순위'에 해당하는 여러 원-핫 컬럼들의 shap값을 카테고리 개수 기준으로 나눕니다. 그리고 shap 값에 대응되는 범주형 데이터를 매핑 및 그룹화하면 됩니다.

![image](https://github.com/user-attachments/assets/d80c2f4c-1ed2-4338-aaf5-5ad929882208)

다음 그림은 '현재 가장 필요한 주거지원 1순위'라는 범주형 변수의 카테고리별 boxplot을 나타낸 것입니다.

![image](https://github.com/user-attachments/assets/fcc45350-accf-44ee-9910-ed23ba1001d3)

x축은 카테고리이고, y축 값이 shap value입니다. 신혼 가구의 경우, 현재 가장 필요한 주거지원 1순위가 '장기공공임대주택 공급'인 경우 '입주의향 있음(1)'에 좋은 영향을 미쳤고, 현재 가장 필요한 주거지원 1순위가 '없음'인 경우 shap value가 음수가 됩니다. 이는 '현재 가장 필요한 주거지원 1순위 - 없음'이 예측을 감소시키는 영향을 미친 것입니다.

다음은 '주택 마련 예상 소요연수'에 대한 결과입니다.

![image](https://github.com/user-attachments/assets/5af4866c-7ea6-4c26-90d8-9c9aa3c1f137)

신혼 가구의 주택 마련 예상 소요연수가 '1년 미만' 또는 '1~3년'으로 비교적 짧을수록 '입주의향 있음(1)'에 부정적인 영향을. 반면, 주택 마련 계획이 아예 없는 경우 '입주의향 있음(1)'에 긍정적인 영향을 준 것을 확인할 수 있습니다

다음은 '현재 주택의 점유형태'에 대한 결과입니다.

![image](https://github.com/user-attachments/assets/e6580fa9-97d4-497d-bf94-eb050b27d88c)

현재 거주 중인 주택의 점유 형태가 '무상'인 경우만 '입주의향 있음(1)'에 부정적인 영향을 미쳤고, 월세와 전세인 경우 모두 긍정적인 영향을 미쳤으며, 특히 보증금이 있는 월세인 경우 다른 카테고리에 비해 '입주의향 있음(1)'에 가장 높은 영향력을 미친 것을 확인할 수 있습니다.

